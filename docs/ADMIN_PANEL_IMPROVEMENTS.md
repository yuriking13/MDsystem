# Улучшения админ-панели MDsystem

## Обзор изменений

Данный документ описывает все улучшения, внесённые в админ-панель системы MDsystem.

## Новые функции

### 1. Управление проектами (`/admin/projects`)

- **Просмотр всех проектов** с детальной статистикой
- **Поиск** по названию проекта
- **Сортировка** по дате создания, количеству документов, статей
- **Удаление проектов** с каскадным удалением связанных данных
- Статистика: документов, статей, ссылок на каждый проект

### 2. Управление фоновыми задачами (`/admin/jobs`)

- **Мониторинг pg-boss jobs** в реальном времени
- **Фильтрация** по статусу (active, completed, failed, created)
- **Отмена активных задач** 
- **Повторный запуск** упавших задач
- Визуализация очереди задач и её состояния

### 3. Мониторинг системы (`/admin/system`)

- **Health Check** - состояние БД, Redis, памяти
- **Статистика базы данных** - размер таблиц, количество записей
- **Использование хранилища** - файлы, размер
- **Действия по очистке**:
  - Удаление старых сессий
  - Очистка завершённых jobs
  - Удаление осиротевших файлов
  - Полная очистка системы

### 4. Управление статьями (`/admin/articles`)

- **Просмотр всех статей** в системе
- **Статистика** по типам публикаций
- **Поиск** по названию и DOI
- **Фильтрация** по привязке к проектам
- **Удаление осиротевших статей** (не привязанных к проектам)

## Технические улучшения

### Производительность

1. **Lazy Loading** - все страницы загружаются по требованию через `React.lazy()`
2. **Suspense** - показ loading-спиннера при загрузке страниц
3. **Оптимизация SQL** - добавлены индексы для частых запросов

### Надёжность

1. **ErrorBoundary** - глобальный обработчик ошибок React
2. **Логирование на сервер** - ошибки клиента отправляются в API
3. **Graceful error handling** - пользователь видит понятное сообщение об ошибке

### DevOps

1. **CI/CD Pipeline** - GitHub Actions для lint, test, build
2. **Pre-commit hooks** - husky + lint-staged для проверки кода
3. **Security audit** - автоматическая проверка зависимостей

## API Endpoints

### Проекты
- `GET /admin/projects` - список проектов
- `DELETE /admin/projects/:id` - удаление проекта

### Jobs
- `GET /admin/jobs` - список задач
- `POST /admin/jobs/:id/cancel` - отмена задачи
- `POST /admin/jobs/:id/retry` - повторный запуск

### Статьи
- `GET /admin/articles` - список статей
- `DELETE /admin/articles/orphan` - удаление осиротевших

### Система
- `GET /admin/storage` - статистика хранилища
- `GET /admin/health` - health check
- `GET /admin/analytics/retention` - метрики удержания
- `GET /admin/config` - конфигурация системы

### Очистка
- `POST /admin/cleanup/sessions` - очистка сессий
- `POST /admin/cleanup/jobs` - очистка jobs
- `POST /admin/cleanup/orphan-files` - осиротевшие файлы
- `POST /admin/cleanup/full` - полная очистка

### Массовые операции
- `POST /admin/users/bulk-block` - блокировка пользователей

## Структура файлов

```
apps/
├── api/src/routes/
│   └── admin.ts              # API endpoints
├── web/src/
│   ├── components/
│   │   └── ErrorBoundary.tsx # Обработка ошибок
│   ├── lib/
│   │   └── adminApi.ts       # API клиент
│   ├── pages/admin/
│   │   ├── AdminProjectsPage.tsx
│   │   ├── AdminJobsPage.tsx
│   │   ├── AdminSystemPage.tsx
│   │   └── AdminArticlesPage.tsx
│   └── styles/
│       └── admin.css         # Стили админки
```

## Использование

### Доступ к админ-панели

1. Авторизуйтесь с правами администратора
2. Перейдите в `/admin`
3. Используйте навигационное меню слева

### Мониторинг системы

1. Откройте `/admin/system`
2. Проверьте статус всех компонентов
3. При необходимости запустите очистку

### Управление задачами

1. Откройте `/admin/jobs`
2. Отфильтруйте по нужному статусу
3. Отмените или перезапустите задачи

## Безопасность

- Все endpoints защищены JWT аутентификацией
- Проверка роли `admin` на каждый запрос
- Rate limiting для защиты от DDoS
- CORS настроен для доверенных доменов
