# üöÄ –§–∞–∑–∞ 1 - –≠–∫—Å–ø–æ—Ä—Ç –≥—Ä–∞—Ñ–∞ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ [–ì–û–¢–û–í–û]

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### 1. –≠–∫—Å–ø–æ—Ä—Ç –≥—Ä–∞—Ñ–∞ —Ü–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏–π

**Endpoint**: `GET /api/projects/:projectId/citation-graph/export?format=<format>`

**–§–æ—Ä–º–∞—Ç—ã**:

- `json` - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π JSON (nodes + links)
- `graphml` - XML —Ñ–æ—Ä–º–∞—Ç –¥–ª—è Gephi, yEd, Cytoscape
- `gexf` - Graph Exchange XML Format –¥–ª—è Gephi
- `cytoscape` - JSON –¥–ª—è Cytoscape.js

**UI**: –ö–Ω–æ–ø–∫–∞ "‚Üì" –≤ header –≥—Ä–∞—Ñ–∞ —Å –≤—ã–ø–∞–¥–∞—é—â–∏–º –º–µ–Ω—é

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ**:

```typescript
const blob = await apiExportCitationGraph(projectId, "graphml");
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫–∞—á–∞–µ—Ç—Å—è —Ñ–∞–π–ª citation-graph-<projectId>.graphml
```

**–ß—Ç–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è**:

- –í—Å–µ —É–∑–ª—ã –≥—Ä–∞—Ñ–∞ —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ (title, year, pmid, doi, journal, citations)
- –í—Å–µ —Å–≤—è–∑–∏ –º–µ–∂–¥—É —É–∑–ª–∞–º–∏ (–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ä—ë–±—Ä–∞)
- –°–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∞—Ç—Ä–∏–±—É—Ç—ã –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞

---

### 2. –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

**Endpoint**: `GET /api/projects/:projectId/citation-graph/recommendations`

**UI**: –ö–Ω–æ–ø–∫–∞ "‚ú®" —Å —Å—á—ë—Ç—á–∏–∫–æ–º —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π

**–¢–∏–ø—ã —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π**:

#### üî¥ –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (High)

1. **orphan_unfetched** - –°—Ç–∞—Ç—å–∏ –±–µ–∑ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å—Å—ã–ª–æ–∫
   - –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –ø–æ—Ç–æ–º—É —á—Ç–æ references –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
   - –î–µ–π—Å—Ç–≤–∏–µ: –∫–Ω–æ–ø–∫–∞ "–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å—Å—ã–ª–∫–∏"

2. **high_cited_unfetched** - –í–∞–∂–Ω—ã–µ —Å—Ç–∞—Ç—å–∏ –±–µ–∑ —Å—Å—ã–ª–æ–∫
   - –í—ã—Å–æ–∫–æ—Ü–∏—Ç–∏—Ä—É–µ–º—ã–µ —Ä–∞–±–æ—Ç—ã (>20 —Ü–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏–π)
   - –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –≥—Ä–∞—Ñ–∞

#### üü† –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (Medium)

3. **orphan_isolated** - –ü–æ–ª–Ω–æ—Å—Ç—å—é –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ç—å–∏
   - –ù–µ—Ç —Å–≤—è–∑–µ–π –¥–∞–∂–µ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Å—ã–ª–æ–∫
   - –í–æ–∑–º–æ–∂–Ω–æ, –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –∏–ª–∏ –æ—à–∏–±–æ—á–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ

#### üîµ –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (Low)

4. **stale_citations** - –£—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ –æ —Ü–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏—è—Ö
   - –î–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ä—à–µ 1 –≥–æ–¥–∞
   - –î–ª—è —Å—Ç–∞—Ç–µ–π –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 10 –ª–µ—Ç

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞**:

```json
{
  "recommendations": [
    {
      "type": "orphan_unfetched",
      "title": "15 —Å—Ç–∞—Ç–µ–π –±–µ–∑ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å—Å—ã–ª–æ–∫",
      "description": "–≠—Ç–∏ —Å—Ç–∞—Ç—å–∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω—ã –ø–æ—Ç–æ–º—É —á—Ç–æ –∏—Ö references –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ PubMed",
      "priority": "high",
      "articleIds": ["uuid1", "uuid2", ...],
      "action": {
        "type": "fetch_references",
        "count": 15
      }
    }
  ],
  "totalCount": 3
}
```

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**–í—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**: ~30 –º–∏–Ω—É—Ç  
**–°—Ç—Ä–æ–∫ –∫–æ–¥–∞**: ~600 (–±—ç–∫–µ–Ω–¥ + —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥)  
**–§–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–æ**: 3

- `apps/api/src/routes/documents.ts` (+350 —Å—Ç—Ä–æ–∫)
- `apps/web/src/components/CitationGraph.tsx` (+180 —Å—Ç—Ä–æ–∫)
- `apps/web/src/lib/api.ts` (+50 —Å—Ç—Ä–æ–∫)

**–ö–æ–º–º–∏—Ç**: `caec829`

---

## üéØ –ü–æ–ª—å–∑–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –≠–∫—Å–ø–æ—Ä—Ç –≥—Ä–∞—Ñ–∞

- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏**: Gephi, Cytoscape, yEd
- **–ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–∏ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏**: –í—ã—Å–æ–∫–æ–∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
- **–ë—ç–∫–∞–ø –¥–∞–Ω–Ω—ã—Ö**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–∞
- **–°–æ–≤–º–µ—Å—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞**: –ü–µ—Ä–µ–¥–∞—á–∞ –≥—Ä–∞—Ñ–∞ –∫–æ–ª–ª–µ–≥–∞–º

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º**: –ù–µ –Ω—É–∂–Ω–æ –≤—Ä—É—á–Ω—É—é –∏—Å–∫–∞—Ç—å –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ç—å–∏
- **–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –¥–µ–π—Å—Ç–≤–∏–π**: –ß—Ç–æ –≤–∞–∂–Ω–µ–µ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø–µ—Ä–≤—ã–º
- **–£–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –≥—Ä–∞—Ñ–∞**: –°–∏—Å—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–¥—Ö–æ–¥ –∫ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—é –ø—Ä–æ–±–µ–ª–æ–≤
- **–≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏**: –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ø—Ä—è–º–æ –∏–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞

---

## üîç –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### GraphML –≥–µ–Ω–µ—Ä–∞—Ü–∏—è

```typescript
function generateGraphML(nodes, links): string {
  // XML —Å escape-—Å–∏–º–≤–æ–ª–∞–º–∏
  // –ê—Ç—Ä–∏–±—É—Ç—ã: label, title, year, pmid, doi, citations
  // –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —Ä—ë–±—Ä–∞ —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ ID
}
```

### GEXF –≥–µ–Ω–µ—Ä–∞—Ü–∏—è

```typescript
function generateGEXF(nodes, links): string {
  // XML —Ñ–æ—Ä–º–∞—Ç Gephi
  // –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∞—Ç—Ä–∏–±—É—Ç–æ–≤ —É–∑–ª–æ–≤
  // –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –≥—Ä–∞—Ñ (mode="static")
}
```

### Cytoscape —Ñ–æ—Ä–º–∞—Ç

```json
{
  "elements": {
    "nodes": [{ "data": { id, label, pmid, ... } }],
    "edges": [{ "data": { id, source, target } }]
  }
}
```

### –î–µ—Ç–µ–∫—Ü–∏—è orphan nodes

```sql
-- –°—Ç–∞—Ç—å–∏ –±–µ–∑ —Å–≤—è–∑–µ–π
SELECT a.id FROM articles a
WHERE a.id IN (project_articles)
  AND NOT EXISTS (
    SELECT 1 FROM articles a2
    WHERE a2.pmid = ANY(a.reference_pmids)
       OR a.pmid = ANY(a2.reference_pmids)
  )
```

---

## üìà –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (–§–∞–∑–∞ 2)

1. **AI-–ø–æ–∏—Å–∫ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Å—Ç–∞—Ç–µ–π** [–í –†–ê–ó–†–ê–ë–û–¢–ö–ï]
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ `/graph-ai-assistant`
   - –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å OpenRouter API

2. **–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è**
   - Embeddings —á–µ—Ä–µ–∑ OpenAI
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ —Ç–µ–º–∞–º
   - –í–∏–∑—É–∞–ª—å–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤

---

## üí° –ò–¥–µ–∏ –¥–ª—è –±—É–¥—É—â–∏—Ö —É–ª—É—á—à–µ–Ω–∏–π

- **–≠–∫—Å–ø–æ—Ä—Ç –≤ PDF/PNG**: –í–∏–∑—É–∞–ª—å–Ω—ã–π —Å–Ω–∏–º–æ–∫ –≥—Ä–∞—Ñ–∞
- **Scheduled recommendations**: Email-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö
- **Auto-fix**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –ø—Ä–æ–±–ª–µ–º
- **Recommendation history**: –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- **Custom recommendations**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞
