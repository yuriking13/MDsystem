# AI ะะณะตะฝั ะัะฐัะฐ: ะะฝะฐะปะธะท ะธ ะฃะปัััะตะฝะธั

## ะขะตะบััะฐั ะััะธัะตะบัััะฐ

### ะะพะผะฟะพะฝะตะฝัั

1. **Frontend** (`CitationGraph.tsx`):
   - ะะฐะฝะตะปั ัะฐัะฐ ัะฟัะฐะฒะฐ ะพั ะณัะฐัะฐ
   - ะััะพัะธั ัะพะพะฑัะตะฝะธะน (aiHistory)
   - ะกะฟะธัะพะบ ะฝะฐะนะดะตะฝะฝัั ััะฐัะตะน (aiFoundArticles)
   - ะัะฑะพั ััะฐัะตะน ะดะปั ะดะพะฑะฐะฒะปะตะฝะธั (aiSelectedForAdd)
   - ะะพะดัะฒะตัะบะฐ ะฝะฐะนะดะตะฝะฝัั ััะฐัะตะน ะฝะฐ ะณัะฐัะต (aiFoundArticleIds)

2. **API** (`articles.ts` โ `/projects/:id/graph-ai-assistant`):
   - ะะพะปััะฐะตั ะฒัะต ััะฐััะธ ะณัะฐัะฐ ั ะผะตัะฐะดะฐะฝะฝัะผะธ
   - ะคะธะปััััะตั ะฒะฝะตัะฝะธะต ััะฐััะธ (level 0, 2, 3)
   - ะคะพัะผะธััะตั ัะธััะตะผะฝัะน ะฟัะพะผะฟั ั ะบะพะฝัะตะบััะพะผ ะฟัะพะตะบัะฐ
   - ะัะทัะฒะฐะตั Claude claude-sonnet-4 ัะตัะตะท OpenRouter
   - ะะฐััะธั JSON ะพัะฒะตั ะธ ะฒะฐะปะธะดะธััะตั ID ััะฐัะตะน

3. **LLM ะะพะดะตะปั**: `anthropic/claude-sonnet-4` (ัะตัะตะท OpenRouter)

### ะขะตะบััะธะต ะะพะทะผะพะถะฝะพััะธ

- ะะพะธัะบ ััะฐัะตะน ะฟะพ ะบะปััะตะฒัะผ ัะปะพะฒะฐะผ/ัะตะผะฐะผ ััะตะดะธ ะทะฐะณััะถะตะฝะฝัั ะฒ ะณัะฐั
- ะคะธะปัััะฐัะธั ะฟะพ ัะธะฟั ะดะธะทะฐะนะฝะฐ ะธััะปะตะดะพะฒะฐะฝะธั ("ะผะตัะฐ-ะฐะฝะฐะปะธะทั", "ะะะ")
- ะัะตะผะตะฝะฝัะต ัะธะปัััั ("ะทะฐ ะฟะพัะปะตะดะฝะธะต 5 ะปะตั")
- ะะพะบะฐะท ะฟัะธัะธะฝั ัะตะปะตะฒะฐะฝัะฝะพััะธ ะดะปั ะบะฐะถะดะพะน ััะฐััะธ
- ะัะฑะพั ะธ ะผะฐััะพะฒะพะต ะดะพะฑะฐะฒะปะตะฝะธะต ะฝะฐะนะดะตะฝะฝัั ััะฐัะตะน

### ะะณัะฐะฝะธัะตะฝะธั

1. **ะะตั ะบะพะฝัะตะบััะฐ ะบะปะฐััะตัะพะฒ** - AI ะฝะต ะทะฝะฐะตั ะพ ัะตะผะฐะฝัะธัะตัะบะธั ะบะปะฐััะตัะฐั
2. **ะะตั ะบะพะฝัะตะบััะฐ gaps** - AI ะฝะต ะทะฝะฐะตั ะพ ะฒััะฒะปะตะฝะฝัั ะฟัะพะฑะตะปะฐั
3. **ะะตั ะบะพะฝัะตะบััะฐ ะผะตัะพะดะพะปะพะณะธะธ** - AI ะฝะต ะฒะธะดะธั ะผะตัะพะดะพะปะพะณะธัะตัะบัั ะพัะตะฝะบั
4. **ะะธะผะธั ััะฐัะตะน** - ะฟะตัะตะดะฐัััั ะดะพ ~500 ััะฐัะตะน (ะพะณัะฐะฝะธัะตะฝะธะต payload)
5. **ะะดะฝะพะฝะฐะฟัะฐะฒะปะตะฝะฝัะน ะฟะพะธัะบ** - ัะพะปัะบะพ ะฟะพะธัะบ, ะฝะตั ะดะธะฐะปะพะณะฐ ะดะปั ััะพัะฝะตะฝะธั

---

## ะัะตะดะปะพะถะตะฝะธั ะฟะพ ะฃะปัััะตะฝะธั

### 1. ๐ฏ ะะฝัะตะณัะฐัะธั ั ะกะตะผะฐะฝัะธัะตัะบะธะผะธ ะะปะฐััะตัะฐะผะธ

**ะัะพะฑะปะตะผะฐ**: AI ะฝะต ะทะฝะฐะตั ะพ ัััะตััะฒัััะธั ะบะปะฐััะตัะฐั ะธ ะฝะต ะผะพะถะตั ะธัะฟะพะปัะทะพะฒะฐัั ะธั ะดะปั ะฟะพะธัะบะฐ.

**ะะตัะตะฝะธะต**: ะะตัะตะดะฐะฒะฐัั ะธะฝัะพัะผะฐัะธั ะพ ะบะปะฐััะตัะฐั ะฒ ัะธััะตะผะฝัะน ะฟัะพะผะฟั.

```typescript
// ะ GraphAIAssistantSchema ะดะพะฑะฐะฒะธัั:
clusters: z.array(z.object({
  id: z.string(),
  name: z.string(),
  articleCount: z.number(),
  centralArticleTitle: z.string().optional(),
  articleIds: z.array(z.string()),
})).optional(),
```

**ะัะธะผะตัั ะฝะพะฒัั ะทะฐะฟัะพัะพะฒ**:

- "ะะฐะนะดะธ ะฟะพัะพะถะธะต ััะฐััะธ ะฝะฐ ะบะปะฐััะตั ะฟัะพ ัะฐัะผะฐะบะพัะตัะฐะฟะธั"
- "ะะฐะบะธะต ััะฐััะธ ะฝะต ะฒะพัะปะธ ะฝะธ ะฒ ะพะดะธะฝ ะบะปะฐััะตั?"
- "ะะฑัะตะดะธะฝะธ ะบะปะฐััะตัั 1 ะธ 3"

### 2. ๐ ะะฝัะตะณัะฐัะธั ั Gap-ะฐะฝะฐะปะธะทะพะผ

**ะัะพะฑะปะตะผะฐ**: AI ะฝะต ะฒะธะดะธั ะฒััะฒะปะตะฝะฝัะต ะฟัะพะฑะตะปั ะฒ ะธััะปะตะดะพะฒะฐะฝะธัั.

**ะะตัะตะฝะธะต**: ะะพะฑะฐะฒะธัั gaps ะฒ ะบะพะฝัะตะบัั:

```typescript
gaps: z.array(z.object({
  type: z.enum(['temporal', 'population', 'methodological', 'geographic']),
  description: z.string(),
  severity: z.enum(['low', 'medium', 'high']),
})).optional(),
```

**ะัะธะผะตัั ะทะฐะฟัะพัะพะฒ**:

- "ะะฐะนะดะธ ััะฐััะธ, ะทะฐะบััะฒะฐััะธะต temporal gap 2015-2020"
- "ะััั ะปะธ ะะะ ะดะปั ะฒััะฒะปะตะฝะฝะพะณะพ methodological gap?"
- "ะัะตะดะปะพะถะธ ะฟะพะธัะบะพะฒัะน ะทะฐะฟัะพั ะดะปั PubMed ะฟะพ gap #2"

### 3. ๐ฌ ะะฝัะตะณัะฐัะธั ั ะะตัะพะดะพะปะพะณะธะตะน

**ะัะพะฑะปะตะผะฐ**: AI ะฝะต ะทะฝะฐะตั ะพะฑ ััะพะฒะฝะต ะดะพะบะฐะทะฐัะตะปัะฝะพััะธ ััะฐัะตะน.

**ะะตัะตะฝะธะต**: ะะตัะตะดะฐะฒะฐัั ะผะตัะพะดะพะปะพะณะธัะตัะบะธะต ะดะฐะฝะฝัะต:

```typescript
// ะ GraphArticleSchema ะดะพะฑะฐะฒะธัั:
evidenceLevel: z.number().min(1).max(5).optional(),
biasRisk: z.enum(['low', 'unclear', 'high']).optional(),
studyDesign: z.string().optional(), // RCT, cohort, case-control, etc.
```

**ะะพะฒัะต ะฒะพะทะผะพะถะฝะพััะธ**:

- "ะะฐะนะดะธ ัะพะปัะบะพ ะะะ ั ะฝะธะทะบะธะผ ัะธัะบะพะผ ะฟัะตะดะฒะทััะพััะธ"
- "ะะพะบะฐะถะธ ััะฐััะธ ั ััะพะฒะฝะตะผ ะดะพะบะฐะทะฐัะตะปัะฝะพััะธ 1-2"
- "ะััะธะปััััะน ะบะพะณะพััะฝัะต ะธััะปะตะดะพะฒะฐะฝะธั"

### 4. ๐ฌ ะะฝะพะณะพัะฐะณะพะฒัะน ะะธะฐะปะพะณ ั ะะพะฝัะตะบััะพะผ

**ะัะพะฑะปะตะผะฐ**: ะะฐะถะดัะน ะทะฐะฟัะพั ะฝะตะทะฐะฒะธัะธะผ, ะฝะตั ะฟะฐะผััะธ ะพ ะฟัะตะดัะดััะธั.

**ะะตัะตะฝะธะต**: ะะตัะตะดะฐะฒะฐัั ะธััะพัะธั ะดะธะฐะปะพะณะฐ ะฒ API:

```typescript
conversationHistory: z.array(z.object({
  role: z.enum(['user', 'assistant']),
  content: z.string(),
  foundArticleIds: z.array(z.string()).optional(),
})).optional(),
```

**ะะพะทะผะพะถะฝะพััะธ**:

- "ะะท ัะตั, ััะพ ัั ะฝะฐััะป, ะพััะฐะฒั ัะพะปัะบะพ 2020+ ะณะพะดะฐ"
- "ะ ััะตะดะธ ะฝะธั ะตััั ะผะตัะฐ-ะฐะฝะฐะปะธะทั?"
- "ะะฑัััะฝะธ ะฟะพะดัะพะฑะฝะตะต ััะฐััั #3"

### 5. ๐ค ะัะพะฐะบัะธะฒะฝัะต ะะตะบะพะผะตะฝะดะฐัะธะธ

**ะะดะตั**: AI ัะฐะผ ะฟัะตะดะปะฐะณะฐะตั ะดะตะนััะฒะธั ะฟัะธ ะฐะฝะฐะปะธะทะต ะณัะฐัะฐ.

**ะะตะฐะปะธะทะฐัะธั**: ะะพะฒัะน endpoint `/projects/:id/graph-ai-analyze`:

```typescript
// ะะฐะฟัะพั ะฑะตะท message, AI ัะฐะผ ะฐะฝะฐะปะธะทะธััะตั ะณัะฐั
POST /projects/:id/graph-ai-analyze
{
  graphArticles: [...],
  clusters: [...],
  gaps: [...],
}

// ะัะฒะตั ั ัะตะบะพะผะตะฝะดะฐัะธัะผะธ
{
  insights: [
    { type: 'cluster', message: 'ะะปะฐััะตั "Therapy" ะธะผะตะตั ะผะฐะปะพ ัะธัะธัะพะฒะฐะฝะธะน' },
    { type: 'gap', message: 'ะะฑะฝะฐััะถะตะฝ gap: ะฝะตั ะะะ ะฟะพัะปะต 2020' },
    { type: 'outlier', message: 'ะกัะฐััั X ะฝะต ัะฒัะทะฐะฝะฐ ั ะดััะณะธะผะธ' },
  ],
  suggestedActions: [
    { action: 'search', query: 'ะฝะฐะนะดะธ ัะฒะตะถะธะต ะะะ', reason: 'ะทะฐะบัััั temporal gap' },
    { action: 'merge', clusterIds: ['c1', 'c2'], reason: 'ััะพะถะฐั ัะตะผะฐัะธะบะฐ' },
  ],
}
```

### 6. ๐ ะะพะธัะบ ะฒะพ ะะฝะตัะฝะธั ะััะพัะฝะธะบะฐั

**ะะดะตั**: AI ะผะพะถะตั ะฟัะตะดะปะพะถะธัั ะฟะพะธัะบะพะฒัะต ะทะฐะฟัะพัั ะดะปั PubMed/DOAJ.

**ะะตะฐะปะธะทะฐัะธั**: ะ ะพัะฒะตัะต AI ะดะพะฑะฐะฒะธัั:

```typescript
externalSearchSuggestions: [
  {
    source: "pubmed" | "doaj" | "wiley",
    query: "string",
    reason: "ะะปั ะทะฐะบัััะธั gap X",
  },
];
```

### 7. ๐ Streaming ะัะฒะตัะพะฒ

**ะัะพะฑะปะตะผะฐ**: ะะพะปะณะพะต ะพะถะธะดะฐะฝะธะต ะฟัะธ ะฑะพะปััะพะผ ะบะพะฝัะตะบััะต.

**ะะตัะตะฝะธะต**: Server-Sent Events ะดะปั streaming:

```typescript
// API ะฒะพะทะฒัะฐัะฐะตั stream
const response = await fetch("/api/graph-ai-assistant", {
  method: "POST",
  body: JSON.stringify(payload),
});

const reader = response.body.getReader();
while (true) {
  const { done, value } = await reader.read();
  if (done) break;
  // ะะฑะฝะพะฒะปัะตะผ UI ะฟะพ ัะฐัััะผ
  appendToResponse(new TextDecoder().decode(value));
}
```

---

## ะัะธะพัะธัะตัั ะะตะฐะปะธะทะฐัะธะธ

| #   | ะฃะปัััะตะฝะธะต                | ะกะปะพะถะฝะพััั | ะะปะธัะฝะธะต | ะัะธะพัะธัะตั |
| --- | ------------------------ | --------- | ------- | --------- |
| 1   | ะะพะฝัะตะบัั ะบะปะฐััะตัะพะฒ       | ะะธะทะบะฐั    | ะััะพะบะพะต | ๐ฅ P0     |
| 2   | ะะพะฝัะตะบัั gaps            | ะะธะทะบะฐั    | ะััะพะบะพะต | ๐ฅ P0     |
| 3   | ะะฝะพะณะพัะฐะณะพะฒัะน ะดะธะฐะปะพะณ      | ะกัะตะดะฝัั   | ะกัะตะดะฝะตะต | P1        |
| 4   | ะะพะฝัะตะบัั ะผะตัะพะดะพะปะพะณะธะธ     | ะะธะทะบะฐั    | ะกัะตะดะฝะตะต | P1        |
| 5   | ะัะพะฐะบัะธะฒะฝัะต ัะตะบะพะผะตะฝะดะฐัะธะธ | ะััะพะบะฐั   | ะััะพะบะพะต | P2        |
| 6   | ะะฝะตัะฝะธะน ะฟะพะธัะบ            | ะกัะตะดะฝัั   | ะััะพะบะพะต | P2        |
| 7   | Streaming                | ะกัะตะดะฝัั   | ะกัะตะดะฝะตะต | P3        |

---

## ะัััััะต ะฃะปัััะตะฝะธั (Quick Wins)

### 1. ะะพะฑะฐะฒะธัั ะบะปะฐััะตัั ะฒ ัะธััะตะผะฝัะน ะฟัะพะผะฟั

```typescript
// ะ articles.ts, ะฟะพัะปะต ะฟะพะปััะตะฝะธั graphArticles:

// ะะพะปััะฐะตะผ ะบะปะฐััะตัั ะธะท ะทะฐะฟัะพัะฐ
const clustersInfo =
  clusters?.length > 0
    ? `\n\nะกะะะะะขะะงะะกะะะ ะะะะกะขะะะซ (${clusters.length} ัั.):\n` +
      clusters
        .map((c, i) => `${i + 1}. "${c.name}" - ${c.articleCount} ััะฐัะตะน`)
        .join("\n")
    : "";

// ะะพะฑะฐะฒะปัะตะผ ะฒ systemPrompt
const systemPrompt = `...
${clustersInfo}
...`;
```

### 2. ะะพะฑะฐะฒะธัั gaps ะฒ ะบะพะฝัะตะบัั

```typescript
const gapsInfo =
  gaps?.length > 0
    ? `\n\nะะซะฏะะะะะะซะ ะะะะะะะซ (${gaps.length} ัั.):\n` +
      gaps
        .map((g, i) => `${i + 1}. [${g.type}] ${g.description} (${g.severity})`)
        .join("\n")
    : "";
```

### 3. ะฃะปัััะธัั ะฟัะธะผะตัั ะทะฐะฟัะพัะพะฒ ะฒ UI

```tsx
// ะ CitationGraph.tsx, ัะฐะทะดะตะป ะฟัะธะผะตัะพะฒ:
<p style={{ fontStyle: "italic", marginBottom: 4 }}>
  ๐ก ยซะะฐะนะดะธ ััะฐััะธ ะธะท ะบะปะฐััะตัะฐ ะฟัะพ ัะฐัะผะฐะบะพัะตัะฐะฟะธัยป
</p>
<p style={{ fontStyle: "italic", marginBottom: 4 }}>
  ๐ก ยซะะฐะบะธะต ััะฐััะธ ะทะฐะบััะฒะฐัั ะฒััะฒะปะตะฝะฝัะต gaps?ยป
</p>
<p style={{ fontStyle: "italic", marginBottom: 4 }}>
  ๐ก ยซะกัะฐะฒะฝะธ ะผะตัะพะดะพะปะพะณะธั ััะฐัะตะน 2015 ะธ 2020 ะณะพะดะพะฒยป
</p>
```

---

## ะะตััะธะบะธ ะฃัะฟะตัะฐ

1. **ะขะพัะฝะพััั ะฟะพะธัะบะฐ**: % ัะตะปะตะฒะฐะฝัะฝัั ััะฐัะตะน ะฒ ัะพะฟ-10
2. **ะัะตะผั ะพัะฒะตัะฐ**: <5 ัะตะบ ะดะปั ัะธะฟะธัะฝะพะณะพ ะทะฐะฟัะพัะฐ
3. **Engagement**: % ะฟะพะปัะทะพะฒะฐัะตะปะตะน, ะธัะฟะพะปัะทัััะธั AI ะฟะพัะปะต ะฟะตัะฒะพะณะพ ัะฐะทะฐ
4. **ะะพะฝะฒะตััะธั**: % ะฝะฐะนะดะตะฝะฝัั ััะฐัะตะน, ะดะพะฑะฐะฒะปะตะฝะฝัั ะฒ ะฟัะพะตะบั

---

## ะกะปะตะดัััะธะต ะจะฐะณะธ

1. [ ] ะะพะฑะฐะฒะธัั ะฟะตัะตะดะฐัั ะบะปะฐััะตัะพะฒ ะฒ API
2. [ ] ะะพะฑะฐะฒะธัั ะฟะตัะตะดะฐัั gaps ะฒ API
3. [ ] ะะฑะฝะพะฒะธัั ัะธััะตะผะฝัะน ะฟัะพะผะฟั ั ะฝะพะฒัะผ ะบะพะฝัะตะบััะพะผ
4. [ ] ะะพะฑะฐะฒะธัั ะฝะพะฒัะต ะฟัะธะผะตัั ะทะฐะฟัะพัะพะฒ ะฒ UI
5. [ ] ะขะตััะธัะพะฒะฐะฝะธะต ั ัะตะฐะปัะฝัะผะธ ะฟัะพะตะบัะฐะผะธ
