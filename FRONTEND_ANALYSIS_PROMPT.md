# Анализ и улучшение фронтенда MDsystem

## О проекте

MDsystem - это научно-исследовательская платформа для работы с медицинскими публикациями, создания научных обзоров и анализа литературы. Система предназначена для исследователей, врачей и научных работников.

## Технологический стек

### Основные технологии

- **React 18.3.1** с TypeScript
- **React Router** для навигации
- **Vite** как build tool
- **TanStack Query (React Query)** для управления серверным состоянием
- **Flowbite** и **Flowbite React** - UI компоненты

### Редакторы

- **Tiptap 3.14** - основной WYSIWYG редактор
- **Lexical 0.39** - альтернативный редактор (частично используется)

### Визуализация данных

- **Chart.js 4.5.1** с React-ChartJS-2
- **@sgratzl/chartjs-chart-boxplot** для boxplot диаграмм
- **ReactFlow** для графов цитирований

### Экспорт документов

- **docx 9.5.1** для экспорта в Word
- **html2pdf.js** для экспорта в PDF
- **file-saver** для скачивания файлов

---

## Архитектура приложения

### Структура маршрутов

#### Публичные страницы (без авторизации):

1. **LoginPage** (`/login`) - вход в систему с демонстрацией функций
2. **RegisterPage** (`/register`) - регистрация новых пользователей
3. **ForgotPasswordPage** (`/forgot-password`) - восстановление пароля
4. **ResetPasswordPage** (`/reset-password`) - сброс пароля по токену

#### Защищённые страницы (требуют авторизацию):

5. **ProjectsPage** (`/projects`) - список проектов пользователя
6. **ProjectDetailPage** (`/projects/:id`) - детальная страница проекта
7. **DocumentPage** (`/projects/:projectId/documents/:docId`) - редактор документов
8. **SettingsPage** (`/settings`) - настройки API ключей
9. **DocumentationPage** (`/docs`) - документация системы

---

## Детальное описание страниц

### 1. LoginPage

**Функциональность:**

- Форма входа (email + пароль)
- Чекбокс "Запомнить меня"
- Ссылка на восстановление пароля
- Левая панель с списком ключевых возможностей системы:
  - Умный поиск статей (PubMed, DOAJ, Wiley)
  - Граф цитирований
  - AI-ассистент
  - Редактор документов
- Валидация форм с отображением ошибок

**UI особенности:**

- Двухколоночный layout (features слева, форма справа)
- Адаптивный дизайн
- Иконки Heroicons/SVG

### 2. RegisterPage

**Функциональность:**

- Форма регистрации (email + пароль)
- Валидация пароля (минимум 8 символов)
- Чекбокс согласия с условиями использования
- Аналогичная левая панель с features
- Автоматический логин после регистрации

### 3. ProjectsPage

**Функциональность:**

- Отображение списка всех проектов пользователя
- Кнопка создания нового проекта
- Модальное окно создания проекта:
  - Название проекта (обязательно)
  - Описание (опционально)
- Карточки проектов с информацией:
  - Название и описание
  - Дата создания/обновления
  - Кнопки действий (открыть, удалить)
- Подтверждение удаления с вводом названия проекта
- Навигация: Settings, Logout

**UI особенности:**

- Grid layout для карточек проектов
- Пустое состояние с подсказкой
- Модальные окна для создания/удаления

### 4. ProjectDetailPage - ГЛАВНАЯ РАБОЧАЯ СТРАНИЦА

**Это самая сложная и функциональная страница системы!**

#### Табы навигации:

1. **Articles (Статьи)**
2. **Documents (Документы)**
3. **Files (Файлы)**
4. **Statistics (Статистика)**
5. **Graph (Граф цитирований)**
6. **Team (Команда)**
7. **Settings (Настройки)**

#### Таб: Articles (ArticlesSection)

**Функции поиска:**

- Многоисточниковый поиск статей:
  - PubMed (с MeSH терминами)
  - DOAJ (открытый доступ)
  - Wiley (полные тексты)
- Расширенные фильтры поиска:
  - Тип публикации (РКИ, мета-анализ, систематический обзор, review, книги)
  - Поля поиска (Title, Abstract, Title/Abstract, MeSH Terms, Author, Journal)
  - Диапазон дат (preset: 1м, 6м, 1г, 2г, 3г, 5г, 10л или custom)
  - Доступность текста (любой, полный, бесплатный полный)
- AI-ассистент для построения запросов
- Добавление статьи по DOI вручную

**Управление статьями:**

- Список статей с карточками, содержащими:
  - Заголовок, авторы, журнал
  - Абстракт (сворачиваемый)
  - DOI, тип публикации, дата
  - Наличие полного текста (PDF)
  - Теги статистики (если обнаружены)
- Статусы статей:
  - Candidate (кандидат на включение)
  - Selected (отобрано)
  - Excluded (исключено)
  - Deleted (удалено)
- Фильтрация по статусу, типу публикации, источнику поиска
- Фильтр "Только со статистикой"

**Массовые операции:**

- Выбор нескольких статей чекбоксами
- Массовое изменение статуса
- Перевод абстрактов на русский (OpenRouter API)
- Обогащение метаданными (ссылки из PubMed)
- AI-детекция статистики в абстрактах
- Экспорт выбранных статей

**Действия с отдельными статьями:**

- Открытие PDF в новой вкладке
- Скачивание PDF
- Просмотр полного текста
- Изменение статуса
- Конвертация в документ
- Удаление

**Счетчики:**

- Количество статей по каждому статусу
- Общее количество

#### Таб: Documents

**Функции:**

- Список документов проекта (научные обзоры, главы, отчёты)
- Создание нового документа:
  - Название
  - Описание (опционально)
- Drag-and-drop переупорядочивание
- Перенумерация цитирований
- Действия:
  - Открыть редактор
  - Переименовать
  - Удалить
- Экспорт документов:
  - Word (.docx) с форматированием
  - PDF с графиками
  - Включение библиографии
- Экспорт библиографии отдельно (Word, PDF, TXT)

#### Таб: Files (Файлы проекта)

**Управление файлами:**

- Загрузка файлов (drag-and-drop или выбор)
- Категории файлов:
  - PDF (научные статьи)
  - Image (изображения)
  - Video (видео)
  - Data (CSV, Excel, JSON)
  - Code (исходный код)
  - Other (прочее)
- Отображение информации:
  - Имя файла, размер, категория
  - Дата загрузки
  - Превью для изображений
  - Кнопки скачивания/удаления
- Анализ PDF:
  - Извлечение метаданных (авторы, заголовок, DOI, abstract)
  - Импорт как статья в базу

**Квоты хранилища:**

- Отображение использованного/доступного места
- Прогресс-бар
- Предупреждения о превышении лимита

#### Таб: Statistics (Статистика)

**Управление данными:**

- Создание статистических наборов:
  - Название, описание
  - Тип данных (Continuous, Categorical, Count, Binary)
  - Группа (Control, Treatment A/B/C, Cohort A/B/C)
  - Классификация (Demographic, Clinical, Laboratory, Outcome, etc.)
  - Данные в виде таблицы или списка значений
- Список созданной статистики с:
  - Заголовком и описанием
  - Типом данных и группой
  - Количеством значений
  - Флагом использования в документах
- Редактирование статистики
- Удаление неиспользуемой статистики
- Очистка неиспользуемой статистики массово

**Создание графиков:**

- Поддержка 8 типов графиков:
  1. **Bar Chart** (столбиковая) - сравнение групп
  2. **Histogram** (гистограмма) - распределение
  3. **Stacked Bar** (внутристолбиковая) - структура
  4. **Pie Chart** (секторная) - доли
  5. **Line Chart** (линейная) - динамика
  6. **Box Plot** (ящичная) - статистическое распределение
  7. **Scatter** (рассеяние) - корреляция
  8. **Doughnut** (кольцевая) - доли
- Для каждого типа:
  - Визуальная иконка
  - Описание применения
  - Примеры данных (шаблоны)
- Мастер создания графика:
  - Выбор типа
  - Ввод/вставка таблицы данных
  - Выбор колонок для осей
  - Настройка параметров (bins для гистограммы)
  - Превью графика
- Вставка графика в документ

#### Таб: Graph (Граф цитирований)

**Визуализация:**

- Интерактивный граф на базе ReactFlow
- Узлы = статьи
- Рёбра = цитирования
- Цветовое кодирование:
  - Candidate (серый)
  - Selected (зелёный)
  - Excluded (красный)
- Панель информации о выбранном узле:
  - Заголовок, авторы, год
  - Журнал, DOI
  - Входящие/исходящие связи
  - Действия (открыть статью, изменить статус)
- Управление отображением:
  - Zoom in/out
  - Fit to view
  - Фильтрация по статусу
  - Показать/скрыть метки
- Экспорт графа в PNG

#### Таб: Team (Команда)

**Функции совместной работы:**

- Список участников проекта с ролями:
  - Owner (владелец)
  - Editor (редактор)
  - Viewer (наблюдатель)
- Приглашение новых участников по email
- Удаление участников (только для Owner)
- Права доступа:
  - Owner: полный доступ
  - Editor: редактирование без управления командой
  - Viewer: только чтение

#### Таб: Settings (Настройки проекта)

**Настройки:**

- Редактирование названия и описания проекта
- Тип исследования:
  - Literature Review (литературный обзор)
  - Systematic Review (систематический обзор)
  - Meta-Analysis (мета-анализ)
  - Clinical Trial (клиническое исследование)
  - Observational Study (наблюдательное исследование)
- Протокол исследования:
  - PRISMA (для систематических обзоров)
  - CONSORT (для РКИ)
  - STROBE (для наблюдательных)
  - MOOSE (для мета-анализов наблюдательных)
  - Custom (произвольный)
- Стиль цитирования:
  - Vancouver (цифры)
  - APA
  - Harvard
  - MLA
  - Chicago
- Язык документов (English/Russian)
- Удаление проекта с подтверждением

### 5. DocumentPage - РЕДАКТОР ДОКУМЕНТОВ

**Основной редактор - Tiptap WYSIWYG**

#### Функции форматирования:

- Базовое форматирование:
  - Bold, Italic, Underline, Strike
  - Заголовки (H1-H6)
  - Параграфы, цитаты, код
  - Списки (маркированные, нумерованные)
- Расширенное:
  - Выравнивание (left, center, right, justify)
  - Цвет текста (палитра)
  - Highlight (маркер)
  - Font family
  - Ссылки
  - Изображения
  - Таблицы с редактором

#### Специализированные функции:

**1. Вставка цитирований:**

- Модальное окно выбора статьи из проекта
- Поиск по названию/авторам
- Фильтр по статусу
- Автоматическая нумерация цитат
- Стили цитирования (Vancouver, APA, etc.)
- Inline citations с номерами
- Редактирование примечаний к цитате
- Удаление цитирований
- Синхронизация после изменений

**2. Боковая панель библиографии:**

- Список всех использованных в документе цитирований
- Сортировка по номеру/названию
- Навигация к цитированию в тексте
- Действия: удалить цитирование
- Счётчик использованных статей

**3. Вставка статистики:**

- Выбор из созданных наборов данных
- Вставка как таблица или текст
- Автоматическое отслеживание использования
- Синхронизация при изменениях

**4. Вставка графиков:**

- Выбор типа графика
- Интерактивный мастер создания
- Рендеринг Chart.js в редакторе
- Изменение размера
- Редактирование/удаление

**5. Вставка файлов проекта:**

- Модальное окно со всеми файлами
- Превью для изображений/видео
- Категоризация
- Вставка с указанием подписи
- Различное отображение:
  - Изображения: inline preview
  - PDF: иконка + название
  - Видео: video player
  - Другие: иконка + ссылка скачивания
- Автоматическое отслеживание использования

**6. Структура документа:**

- Автоматическая навигация по заголовкам
- Outline/Table of Contents
- Переход к секциям
- Подсчёт слов и символов

**7. Версионирование:**

- Автосохранение каждые 30 секунд
- Ручное создание версий
- Триггеры автоматических версий:
  - Экспорт документа
  - Изменение цитирований
  - Долгий период неактивности
- Список версий с датами
- Превью версии
- Восстановление версии
- Система истории изменений

**8. Настройки страницы:**

- Размер страницы (A4, Letter, Legal)
- Поля (Normal, Narrow, Wide, Custom)
- Ориентация (Portrait, Landscape)
- Масштаб редактора (50%-200%)
- Применение к визуализации

**9. Toolbar (панель инструментов):**

- История (Undo/Redo)
- Форматирование текста
- Параграфы и заголовки
- Списки
- Таблицы
- Медиа (изображение, граф, таблица данных, файл)
- Цитирования
- Специальные вставки
- Настройки документа
- Экспорт (Word, PDF)

**10. Экспорт документов:**

- Word (.docx):
  - Полное форматирование
  - Встроенные графики (PNG)
  - Таблицы
  - Изображения
  - Библиография в конце
  - Настройки страницы
- PDF:
  - Рендеринг через html2pdf
  - Графики как изображения
  - Сохранение форматирования

### 6. SettingsPage

**Управление API ключами:**

- Настройка ключей для внешних сервисов:
  - **PubMed API** - поиск статей и связей
  - **DOAJ API** - открытые журналы
  - **Wiley TDM API** - полные тексты
  - **OpenRouter API** - AI-функции (перевод, детекция статистики)
- Для каждого провайдера:
  - Иконка и описание
  - Статус (настроен/не настроен)
  - Поле ввода (скрытое для безопасности)
  - Кнопки: сохранить, удалить
- Сброс онбординга (инструктаж для новых пользователей)

### 7. DocumentationPage

**Внутренняя документация:**

- Навигация по разделам:
  - Обзор платформы
  - База статей
  - Документы
  - Файлы
  - Статистика
  - Граф цитирований
  - Команда
  - Настройки проекта
  - API ключи
- Подробные инструкции для каждого раздела
- Скриншоты и примеры
- Советы и best practices

---

## Ключевые компоненты

### ArticlesSection

**Самый сложный компонент для работы со статьями**

- Интеграция с 3 источниками (PubMed, DOAJ, Wiley)
- AI-ассистент для построения запросов
- Расширенные фильтры
- Массовые операции
- Управление статусами
- Детекция статистики
- Перевод
- Обогащение метаданными
- Более 3000 строк кода

### TiptapEditor

**Богатый текстовый редактор**

- 30+ расширений Tiptap
- Кастомные ноды:
  - CitationNode (цитирования)
  - ChartNode (графики)
  - ProjectFileNode (файлы)
  - StatisticNode (статистика)
- Toolbar с 50+ функциями
- Боковые панели (библиография, структура)
- Автосохранение и версионирование

### CitationGraph

**Граф цитирований на ReactFlow**

- Интерактивная визуализация
- Алгоритм layout (dagre/force-directed)
- Цветовое кодирование
- Панель информации
- Экспорт в PNG
- Фильтры и zoom

### ChartFromTable

**Компонент создания графиков**

- 8 типов диаграмм
- Интерактивный мастер
- Chart.js интеграция
- Парсинг таблиц
- Шаблоны данных
- Экспорт графиков

### ProgressModal

**Модальное окно прогресса**

- SSE (Server-Sent Events) для real-time обновлений
- Прогресс-бар
- Скорость выполнения
- ETA (время до завершения)
- Обработка ошибок
- Отмена операции

### OnboardingTour

**Интерактивный тур для новых пользователей**

- Пошаговые подсказки
- Подсветка элементов
- Навигация по шагам
- Пропуск/завершение
- LocalStorage для отслеживания

### Toast/Notifications

**Система уведомлений**

- Success/Error/Warning/Info
- Автоматическое скрытие
- Stack нескольких уведомлений
- Context API для глобального доступа

---

## Текущие проблемы и ограничения

### UX/UI проблемы:

1. **Перегруженность интерфейса** - слишком много функций на одной странице (ProjectDetailPage)
2. **Отсутствие навигационных подсказок** - пользователь может потеряться
3. **Нет поиска** в длинных списках (статьи, файлы)
4. **Мобильная версия** практически отсутствует
5. **Темы** - тёмная тема есть, но переключение примитивное
6. **Accessibility** - нет ARIA меток, навигации с клавиатуры
7. **Loading states** - некоторые операции не показывают прогресс

### Производительность:

1. **Ленивая загрузка** - используется для страниц, но не для компонентов
2. **Виртуализация списков** - длинные списки статей/файлов не виртуализированы
3. **Оптимизация ре-рендеров** - отсутствие React.memo, useMemo, useCallback где нужно
4. **Bundle size** - большой размер бандла из-за множества библиотек
5. **Дублирование кода** - некоторая логика повторяется в разных местах

### Функциональные:

1. **Drag-and-drop** - работает для документов, но не для статей/файлов
2. **Bulk operations** - не хватает массовых операций для файлов
3. **Offline mode** - отсутствует
4. **Auto-save индикатор** - не показывается статус сохранения
5. **Collaborative editing** - нет real-time коллаборации
6. **Комментарии** - нельзя оставлять комментарии в документах
7. **Экспорт графа** - только PNG, нет SVG/PDF
8. **Фильтры** - не сохраняются между сессиями

### Архитектурные:

1. **State management** - используется useState вместо более продвинутых решений
2. **API клиент** - нет централизованной обработки ошибок
3. **Типизация** - TypeScript используется, но есть any
4. **Тестирование** - отсутствует
5. **Error boundaries** - есть базовый, но не везде
6. **Validation** - клиентская валидация форм недостаточна

### Безопасность:

1. **XSS** - вставка HTML из редактора может быть уязвимой
2. **CSRF токены** - отсутствуют
3. **Rate limiting** - только на бэкенде
4. **Sensitive data** - API ключи отображаются (хоть и скрыто)

---

## Задача для AI анализа

**Проанализируйте описанный фронтенд и предложите конкретные улучшения в следующих категориях:**

### 1. UX/UI улучшения

- Упрощение навигации
- Улучшение визуальной иерархии
- Мобильная адаптация
- Accessibility (a11y)
- Улучшение микроинтеракций
- Consistency в дизайне

### 2. Производительность

- Code splitting стратегии
- Виртуализация списков
- Оптимизация ре-рендеров
- Lazy loading стратегии
- Bundle size reduction
- Кеширование

### 3. Функциональные улучшения

- Недостающие функции
- Улучшение существующих возможностей
- Новые способы взаимодействия с данными
- Автоматизация рутинных задач
- Интеграции с внешними сервисами

### 4. Developer Experience

- Улучшение структуры кода
- Паттерны проектирования
- Типизация
- Документация кода
- Тестирование
- Dev tools

### 5. Архитектура

- State management стратегии
- Оптимизация API взаимодействий
- Error handling
- Формы и валидация
- Routing оптимизация

### 6. Безопасность

- Защита от XSS, CSRF
- Безопасное хранение чувствительных данных
- Санитизация пользовательского ввода
- Rate limiting на клиенте

### 7. Инновационные фичи

- AI-интеграции
- Расширенная визуализация
- Collaborative features
- Персонализация
- Аналитика для пользователя

---

## Формат ответа

Для каждой категории предоставьте:

1. **Приоритет** (High/Medium/Low)
2. **Описание проблемы/возможности**
3. **Конкретное решение**
4. **Технический подход** (какие библиотеки/паттерны использовать)
5. **Оценка сложности** (Simple/Medium/Complex)
6. **Ожидаемый эффект** (для пользователя и разработчика)
7. **Примерный код или псевдокод** (где применимо)

Сфокусируйтесь на **практических, реализуемых** улучшениях, которые дадут максимальную ценность для научных исследователей, использующих эту платформу.
